name: Migrate JSON Keys (id to countryName)

on:
  workflow_dispatch: # This allows you to run it manually from the Actions tab

jobs:
  migrate:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Run Migration Script
        run: |
          node -e "
          const fs = require('fs');
          const path = require('path');

          const folders = ['first-names', 'last-names'];

          folders.forEach(folder => {
            const dirPath = path.join(process.cwd(), folder);
            if (!fs.existsSync(dirPath)) return;

            const files = fs.readdirSync(dirPath).filter(f => f.endsWith('.json'));

            files.forEach(file => {
              const filePath = path.join(dirPath, file);
              const data = JSON.parse(fs.readFileSync(filePath, 'utf8'));

              // If 'id' exists and is a string, rename it to 'countryName'
              if (data.hasOwnProperty('id') && typeof data.id === 'string') {
                data.countryName = data.id;
                delete data.id;
          
                fs.writeFileSync(filePath, JSON.stringify(data, null, 2));
                console.log('Migrated: ' + folder + '/' + file);
              }
            });
          });
          "

      - name: Commit and Push changes
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git add first-names/*.json last-names/*.json
          git commit -m "refactor: rename id to countryName in source files" || echo "No changes to migrate"
          git push
